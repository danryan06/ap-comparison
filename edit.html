<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Edit AP Information &mdash; Enterprise AP Comparison Database</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="header-with-logo">
      <h1><a href="index.html">Enterprise AP Comparison Database</a></h1>
      <img src="logo.png" alt="Enterprise AP Comparison Database" class="site-logo" />
    </div>
    <h2>Edit Existing AP Information</h2>
    <p class="subtitle">
      Use this form to generate an updated JSON entry for an existing AP. After generating the JSON,
      click “Open GitHub Issue with This Update” to open a prefilled GitHub issue and submit it.
    </p>

    <div class="actions">
      <a class="btn-link" href="index.html">&larr; Back to AP Table</a>
    </div>

    <div class="card">
      <span class="badge">Edit AP</span>

      <form id="edit-ap-form">
        <div class="form-grid">
          <div class="form-row">
            <label for="existing">Which AP are you editing? (Vendor + Model)</label>
            <select id="existing" name="existing">
              <option value="">Select an AP to edit…</option>
            </select>
          </div>

          <div class="form-row">
            <label for="vendor">Vendor</label>
            <input id="vendor" name="vendor" type="text" placeholder="Juniper, Cisco, Aruba, Ruckus, etc." required />
          </div>

          <div class="form-row">
            <label for="model">Model</label>
            <input id="model" name="model" type="text" placeholder="AP45, Catalyst 9166I, AP-655, etc." required />
          </div>

          <div class="form-row">
            <label for="wifi_gen_radios">Wi-Fi Gen &amp; Radios</label>
            <input id="wifi_gen_radios" name="wifi_gen_radios" type="text" placeholder="Wi-Fi 6E (2.4/5/6)" required />
          </div>

          <div class="form-row">
            <label for="spatial_streams">Spatial Streams (2.4 / 5 / 6 GHz)</label>
            <input id="spatial_streams" name="spatial_streams" type="text" placeholder="4x4 / 4x4 / 4x4" required />
          </div>

          <div class="form-row">
            <label for="min_poe_class">Min PoE Class</label>
            <input id="min_poe_class" name="min_poe_class" type="text" placeholder="802.3at (Class 4)" required />
          </div>

          <div class="form-row">
            <label for="recommended_poe">Recommended PoE</label>
            <input id="recommended_poe" name="recommended_poe" type="text" placeholder="802.3bt (Class 6) or 30 W, etc." required />
          </div>

          <div class="form-row">
            <label for="behavior_min_power">Behavior at Min Power</label>
            <textarea id="behavior_min_power" name="behavior_min_power" placeholder="1–2 sentences about what the AP does at minimum PoE (e.g., disables USB, reduces TX power, shuts off a band)." required></textarea>
          </div>

          <div class="form-row">
            <label for="ethernet_ports_speed">Ethernet Ports &amp; Speed</label>
            <input id="ethernet_ports_speed" name="ethernet_ports_speed" type="text" placeholder="1×2.5GbE, 2×5GbE, etc." required />
          </div>

          <div class="form-row">
            <label for="antenna_type">Antenna Type</label>
            <select id="antenna_type" name="antenna_type" required>
              <option value="" disabled selected>Select antenna type</option>
              <option>Internal</option>
              <option>External</option>
              <option>Directional</option>
            </select>
          </div>

          <div class="form-row">
            <label for="form_factor">Form Factor</label>
            <select id="form_factor" name="form_factor" required>
              <option value="" disabled selected>Select form factor</option>
              <option>Indoor</option>
              <option>Outdoor</option>
              <option>Wallplate</option>
            </select>
          </div>

          <div class="form-row">
            <label for="radios_iot_features">Radios &amp; IoT Features (comma-separated)</label>
            <input id="radios_iot_features" name="radios_iot_features" type="text" placeholder="BLE, Zigbee, GPS, vBLE array, sensor radio" />
          </div>

          <div class="form-row">
            <label for="datasheet_url">Datasheet URL</label>
            <input
              id="datasheet_url"
              name="datasheet_url"
              type="url"
              placeholder="https://example.com/datasheet.pdf"
              required
            />
          </div>

          <div class="form-row">
            <label for="image_url">Image URL (optional)</label>
            <input
              id="image_url"
              name="image_url"
              type="url"
              placeholder="https://example.com/path-to-ap-image.jpg"
            />
          </div>

          <div class="form-row">
            <label for="dimensions">Dimensions</label>
            <input id="dimensions" name="dimensions" type="text" placeholder='e.g., 240 × 240 × 61 mm' />
          </div>

          <div class="form-row">
            <label for="weight">Weight</label>
            <input id="weight" name="weight" type="text" placeholder="e.g., 1.2 kg or 2.6 lb" />
          </div>

          <div class="form-row">
            <label for="antenna_connectors">Antenna Connectors</label>
            <input id="antenna_connectors" name="antenna_connectors" type="text" placeholder="Free-form (e.g., 4×RP-SMA, none)" />
          </div>

          <div class="form-row">
            <label for="operating_temp_range">Operating Temperature Range</label>
            <input id="operating_temp_range" name="operating_temp_range" type="text" placeholder="e.g., -20°C to 50°C" />
          </div>

          <div class="form-row">
            <label for="msrp">MSRP</label>
            <input id="msrp" name="msrp" type="text" placeholder="~$2,195" required />
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary">Generate Updated JSON Snippet</button>
          <button type="button" class="btn-link" id="open-issue-btn">Open GitHub Issue with This Update</button>
        </div>
      </form>

      <div class="output-box">
        <label for="output">Updated JSON entry (replace the existing object in <code>ap_data.json</code>):</label>
        <textarea id="output" readonly placeholder="Your updated JSON snippet will appear here after you generate it."></textarea>
        <p class="hint" style="margin-top:0.5rem;">
          Step 1: Load the AP, update the fields, and click “Generate Updated JSON Snippet”. Step 2: Click
          “Open GitHub Issue with This Update” and submit the pre-filled issue in GitHub.
        </p>
      </div>

      <div class="footer">
        Workflow: Generate updated JSON ➜ open the prefilled GitHub issue ➜ review and submit ➜ automation creates the pull request.
      </div>
    </div>
  </div>

  <script>
    // TODO: set these to your actual GitHub username and repo name
    const GITHUB_USER = 'danryan06';
    const GITHUB_REPO = 'ap-comparison';
    const DATA_URL = 'ap_data.json';
    let apList = [];

    function buildApObjectFromForm() {
      const vendor = document.getElementById('vendor').value.trim();
      const model = document.getElementById('model').value.trim();
      const wifi_gen_radios = document.getElementById('wifi_gen_radios').value.trim();
      const spatial_streams = document.getElementById('spatial_streams').value.trim();
      const min_poe_class = document.getElementById('min_poe_class').value.trim();
      const recommended_poe = document.getElementById('recommended_poe').value.trim();
      const behavior_min_power = document.getElementById('behavior_min_power').value.trim();
      const ethernet_ports_speed = document.getElementById('ethernet_ports_speed').value.trim();
      const antenna_type = document.getElementById('antenna_type').value.trim();
      const form_factor = document.getElementById('form_factor').value.trim();
      const radios_iot_features_raw = document.getElementById('radios_iot_features').value.trim();
      const datasheet_url = document.getElementById('datasheet_url').value.trim();
      const image_url = document.getElementById('image_url').value.trim();
      const dimensions = document.getElementById('dimensions').value.trim();
      const weight = document.getElementById('weight').value.trim();
      const antenna_connectors = document.getElementById('antenna_connectors').value.trim();
      const operating_temp_range = document.getElementById('operating_temp_range').value.trim();
      const msrp = document.getElementById('msrp').value.trim();

      let radios_iot_features = [];
      if (radios_iot_features_raw.length > 0) {
        radios_iot_features = radios_iot_features_raw
          .split(',')
          .map(s => s.trim())
          .filter(s => s.length > 0);
      }

      return {
        vendor,
        model,
        wifi_gen_radios,
        spatial_streams,
        min_poe_class,
        recommended_poe,
        behavior_min_power,
        ethernet_ports_speed,
        antenna_type,
        form_factor,
        radios_iot_features,
        datasheet_url,
        image_url,
        dimensions,
        weight,
        antenna_connectors,
        operating_temp_range,
        msrp
      };
    }

    function normalizeString(value) {
      if (value == null) return '';
      if (Array.isArray(value)) return value.join(', ');
      return String(value);
    }

    function fillFormWithEntry(entry) {
      document.getElementById('vendor').value = entry.vendor || '';
      document.getElementById('model').value = entry.model || '';
      document.getElementById('wifi_gen_radios').value = entry.wifi_gen_radios || '';
      document.getElementById('spatial_streams').value = entry.spatial_streams || '';
      document.getElementById('min_poe_class').value = entry.min_poe_class || '';
      document.getElementById('recommended_poe').value = entry.recommended_poe || '';
      document.getElementById('behavior_min_power').value = entry.behavior_min_power || '';
      document.getElementById('ethernet_ports_speed').value = entry.ethernet_ports_speed || '';
      document.getElementById('antenna_type').value = entry.antenna_type || '';
      document.getElementById('form_factor').value = entry.form_factor || '';
      document.getElementById('radios_iot_features').value =
        Array.isArray(entry.radios_iot_features) ? entry.radios_iot_features.join(', ') : (entry.radios_iot_features || '');
      document.getElementById('dimensions').value = entry.dimensions || '';
      document.getElementById('weight').value = entry.weight || '';
      document.getElementById('antenna_connectors').value = entry.antenna_connectors || '';
      document.getElementById('operating_temp_range').value = entry.operating_temp_range || '';
      document.getElementById('msrp').value = entry.msrp || '';
      document.getElementById('datasheet_url').value = entry.datasheet_url || '';
    }

    async function loadApList() {
      try {
        const res = await fetch(DATA_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        if (!Array.isArray(data)) throw new Error('Data format error');
        apList = data;
        const select = document.getElementById('existing');
        while (select.options.length > 1) select.remove(1);
        data
          .map((e, i) => ({ label: `${normalizeString(e.vendor)} ${normalizeString(e.model)}`.trim(), index: i }))
          .sort((a, b) => a.label.localeCompare(b.label))
          .forEach(({ label, index }) => {
            const opt = document.createElement('option');
            opt.value = String(index);
            opt.textContent = label;
            select.appendChild(opt);
          });
      } catch (err) {
        console.error('Failed to load AP list:', err);
      }
    }
    document.getElementById('edit-ap-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const obj = buildApObjectFromForm();
      const jsonSnippet = JSON.stringify(obj, null, 2);
      const output = document.getElementById('output');
      output.value = jsonSnippet;
      output.focus();
      output.select();
    });

    function openGithubEditApIssue() {
      const vendor = document.getElementById('vendor').value.trim();
      const model = document.getElementById('model').value.trim();
      const jsonSnippet = document.getElementById('output').value.trim();
      const existingSelect = document.getElementById('existing');
      const existing = existingSelect.value ? existingSelect.options[existingSelect.selectedIndex].textContent.trim() : '';

      if (!vendor || !model) {
        alert('Please fill in at least Vendor and Model, then click "Generate Updated JSON Snippet" before opening the GitHub issue.');
        return;
      }
      if (!jsonSnippet) {
        alert('Please click "Generate Updated JSON Snippet" before opening the GitHub issue.');
        return;
      }

      const title = `Edit AP: ${vendor} ${model}`.trim();
      const bodyLines = [
        'Requested edit for AP via apcomparison.com'
      ];
      if (existing) {
        bodyLines.push(`Requested edit for: ${existing}`);
      }
      bodyLines.push(
        '',
        'JSON entry (do not edit unless you know what you\'re doing):',
        '',
        '```json',
        jsonSnippet,
        '```',
        '',
        'Submitted via on-site edit form.'
      );

      const body = bodyLines.join('\n');
      const url = `https://github.com/${encodeURIComponent(GITHUB_USER)}/${encodeURIComponent(GITHUB_REPO)}/issues/new?title=${encodeURIComponent(title)}&body=${encodeURIComponent(body)}`;
      window.open(url, '_blank', 'noopener');
    }

    document.getElementById('open-issue-btn').addEventListener('click', openGithubEditApIssue);
    document.getElementById('existing').addEventListener('change', function () {
      const idx = this.value ? parseInt(this.value, 10) : -1;
      if (idx >= 0 && apList[idx]) fillFormWithEntry(apList[idx]);
    });
    document.addEventListener('DOMContentLoaded', loadApList);
  </script>
</body>
</html>
